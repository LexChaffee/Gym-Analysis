---
title: "Gym Analysis Project"
author: "Lex Chaffee"
date: "2025-01-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Libraries, echo=FALSE, results="hide", message=FALSE, warning=FALSE}
library(ggplot2)
library(dplyr)
library(corrplot)
library(readr)
library(tidyverse)
```
Age: Age of the gym member.
Gender: Gender of the gym member (Male or Female).
Weight (kg): Member’s weight in kilograms.
Height (m): Member’s height in meters.
Max_BPM: Maximum heart rate (beats per minute) during workout sessions.
Avg_BPM: Average heart rate during workout sessions.
Resting_BPM: Heart rate at rest before workout.
Session_Duration (hours): Duration of each workout session in hours.
Calories_Burned: Total calories burned during each session.
Workout_Type: Type of workout performed (e.g., Cardio, Strength, Yoga, HIIT).
Fat_Percentage: Body fat percentage of the member.
Water_Intake (liters): Daily water intake during workouts.
Workout_Frequency (days/week): Number of workout sessions per week.
Experience_Level: Level of experience, from beginner (1) to expert (3).
BMI: Body Mass Index, calculated from height and weight.

# EDA 
```{r Data, echo=FALSE, results="hide", message=FALSE, warning=FALSE}
# read in data from csv file
gym_data <- read_csv("gym_members_exercise_tracking.csv")

# Shorten column names
colnames(gym_data) <- c("Age", "Gender", "Weight", "Height", "MaxBPM", "AvgBPM", "RestBPM", 
                  "Duration", "CaloriesBurned", "WorkoutType", "FatPct", "WaterIntake", "Freq", 
                  "ExpLvl", "BMI")

```

## Univariate Analysis

Get Basic Summary Statisics for all of the variables
```{r}
summary(gym_data)
```
Check for missingness in the data
```{r}
# Check missingness
is_na_df <- is.na(gym_data)

# Calculate missing counts and percentages
missing_count <- colSums(is_na_df)
missing_percent <- (missing_count / nrow(gym_data)) * 100

# Create a summary table
missing_table <- data.frame(
  Variable = names(missing_count),
  Missing_Count = missing_count,
  Missing_Percent = round(missing_percent, 2)
)

# Sort by missing percentage (optional)
missing_table <- missing_table[order(-missing_table$Missing_Percent), ]

# Print nicely
print(missing_table, row.names = FALSE)

```
None of the data is missing making analysis of the data easier. 

```{r}
#separate categorical from continuous
categorical <- gym_data |> select(c('Gender', 'WorkoutType', 'Freq', 'ExpLvl'))
continuous <- gym_data |> select(-colnames(categorical))
```

## Univariate EDA

```{r}
# Loop through each variable to create a QQ plot
for (variable_name in colnames(continuous)) {
  qqnorm(gym_data[[variable_name]],
         main = paste("Normal Q-Q Plot for", variable_name))
  qqline(gym_data[[variable_name]], col = "red")
}

```
```{r}
# Verify normality using a Shapiro-Wilk's test
shapiro_results <- lapply(continuous, shapiro.test)

print(shapiro_results_lapply)
```
After running this test we see that there is no continuous variable that has normality. This means going forward we have to use to a non-parametric test if we perform any testing. 

Now let's examine the categorical variables
```{r}
for (variable_name in colnames(categorical)) {
  p <- ggplot(categorical, aes_string(x = variable_name)) +
    geom_bar(fill = "steelblue", width = 0.8) 
  print(p)
}

```
Nothing too special is seen in the categorical variables but more may be revealed during bivariate analysis

## Bivariate Analysis

Let's make scatterplots to examine the relationship of continous variables with eachother
```{r}
vars <- colnames(continuous)

# Loop through all combinations of two different continuous variables
for (i in 1:(length(vars)-1)) {
  for (j in (i+1):length(vars)) {
    x_var <- vars[i]
    y_var <- vars[j]
    
    p <- ggplot(continuous, aes_string(x = x_var, y = y_var)) +
      geom_point(color = "steelblue", alpha = 0.6) +
      labs(title = paste("Scatterplot of", x_var, "vs", y_var),
           x = x_var,
           y = y_var) +
      theme_minimal()
    
    print(p)
  }
}
```

Now let's make boxplots to compare continuous to categorical variables so the continuous variables are across different levels
```{r}
cat_vars <- colnames(categorical)
cont_vars <- colnames(continuous)

# Loop through all categorical-continuous combinations
for (cat_var in cat_vars) {
  for (cont_var in cont_vars) {
    p <- ggplot(gym_data, aes_string(x = cat_var, y = cont_var)) +
      geom_boxplot(fill = "steelblue", alpha = 0.7) +
      labs(title = paste("Boxplot of", cont_var, "by", cat_var),
           x = cat_var,
           y = cont_var) +
      theme_minimal()
    
    print(p)
  }
}
```




Let's create a correlation matrix of the continuous variables
```{r}
mydata.cor = cor(continuous, method = c("spearman"))
mydata.cor
```


# Check for Multicollinearity







Split the dataset into a 70/30 train/test datasets
```{r}
set.seed(123)

gym_data <- gym_data %>% mutate(id = row_number())

train <- gym_data %>% sample_frac(0.7)

test <- anti_join(gym_data, train, by = 'id')
```


# Stepwise Regression

Let's now try creating a better model using stepwise regression:

```{r}
# Create full model and empty model
full.model <- lm(CaloriesBurned ~ . , data = train)
empty.model <- lm(CaloriesBurned ~ 1, data = train)
# k = 2 for AIC selection
step.model <- step(empty.model,
scope = list(lower = empty.model,
upper = full.model),
direction = "both", k = 2) 

```
Using stepwise regression, we find that the best model of Calories Burned are Duration, AvgBPM, Gender, Age, Height, and RestBPM.

Let's test that with an Multiple Linear Regression model

```{r}
mlr_model <- lm(CaloriesBurned ~ Duration + AvgBPM + Gender + Age + Height + RestBPM, data = gym_data)
summary(mlr_model)
```


